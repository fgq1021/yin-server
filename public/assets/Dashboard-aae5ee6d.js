import{d as O,o as n,c as r,j as a,_ as M,r as i,i as d,t as h,b as m,n as L,F as j,l as $,a as _,m as F,w as o,h as c,q as z,s as A,K as I,v as H,x as T,y as B,z as C,A as N,B as D}from"./index-8d1328d9.js";import{Y as U}from"./yinMenuItem-33a4d26e.js";const q={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 24 24"},P=a("path",{d:"M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z",fill:"currentColor"},null,-1),K=[P],Y=O({name:"MenuFilled",render:function(t,p){return n(),r("svg",q,K)}}),G=O({name:"dashboardMenuItem",inject:["screen","objectList","keyList"],props:["_key","parent","root"],emits:["menuSel"],data(){return{object:{}}},computed:{title(){return this.root?"主页":this.object._id?this._key.title===this.object._title?this.object._title:this._key.title+": "+this.object._title:this._key.title+": "+(this.object._title||"加载中")},main(){var e;return this.root||!this.object._id?!0:this.objectList[this.place]===((e=this.parent)==null?void 0:e._place.valueOf())},place(){var e,t;return((e=this.object._place)==null?void 0:e.valueOf())||((t=this.object.api)==null?void 0:t.place.valueOf())},open(){var t;if(this.root)return!1;const e=this.screen.target.indexOf(this.place);if(e!==-1)return this.screen.target[e-1]===((t=this.parent)==null?void 0:t._place.valueOf())},target(){if(this.main)return this.screen.target[this.screen.target.length-1]===this.place}},methods:{async init(){var e,t,p,y;if(this.root)this.object=this.root,(e=this.objectList)[t=this.place]??(e[t]="dashboard");else try{this.object=await this.parent[this._key.name],(p=this.objectList)[y=this.place]??(p[y]=this.parent._place.valueOf())}catch{this.object._title="未创建"}},menuSel(e){this.place&&(e?(e.push(this.place),this.$emit("menuSel",e)):this.main?this.$emit("menuSel",[this.place]):this.screen.target=[this.place])}},watch:{main(){var e,t,p;(t=this.objectList)[p=this.place]??(t[p]=(e=this.parent)==null?void 0:e._place.valueOf())}},mounted(){this.init(),this.parent&&this.parent._on("update",this.init)},beforeUnmount(){this.main&&delete this.objectList[this.place],this.parent&&this.parent._removeEvent("update",this.init)}});const J={class:"itemMain"},Q={class:"main"},R={key:0},W={key:1,style:{"margin-left":"13px"}};function X(e,t,p,y,s,v){const b=i("dashboard-menu-item",!0);return n(),r(j,null,[a("div",{class:L(["dashboardMenuItem",{open:e.open,target:e.target}]),onClick:t[0]||(t[0]=l=>e.menuSel())},[a("div",J,[a("div",Q,[a("p",null,[d(h(e.title),1),e.main?m("",!0):(n(),r("span",R,"*"))])]),a("p",null,h(e.object.meta),1)]),a("p",null,h(e.object.info),1)],2),e.root?(n(!0),r(j,{key:0},$(e.root._schemaMix,l=>(n(),r(j,null,[l.type!=="Array"&&e.$yin.structureType.includes(l.type)?(n(),_(b,{key:0,onMenuSel:e.menuSel,_key:l,parent:e.root},null,8,["onMenuSel","_key","parent"])):m("",!0)],64))),256)):e.open?(n(),r("div",W,[(n(!0),r(j,null,$(e.object._schemaMix,l=>(n(),r(j,null,[l.type!=="Array"&&e.$yin.structureType.includes(l.type)?(n(),_(b,{key:0,onMenuSel:e.menuSel,_key:l,parent:e.object},null,8,["onMenuSel","_key","parent"])):m("",!0)],64))),256))])):m("",!0)],64)}const Z=M(G,[["render",X],["__scopeId","data-v-4263ded7"]]),x=O({name:"dashboardEditorObject",inject:["screen","objectList","keyList"],props:["_key","parent"],data(){return{object:{},models:[]}},computed:{title(){return this._key&&this.parent?this.object._id?this._key.title===this.object._title?this.object._title:this._key.title+": "+this.object._title:this._key.title+": "+(this.object._title||"加载中"):""}},methods:{async init(){if(this.parent)try{this.object=await this.parent[this._key.name]}catch{this.object._title="未创建",this.models=await this.parent[this._key.name].models()}},menuSel(){this.object._id&&this.screen.target.push(this.object._place.valueOf())},async create(e){this.object=await this.parent[this._key.name].create({_model:e._id})}},mounted(){this.init()}});function ee(e,t,p,y,s,v){const b=i("n-input-group-label"),l=i("n-button"),f=i("n-input-group"),k=i("n-card");return n(),_(k,{title:e.title,size:"small",class:"dashboardEditorObject",style:z({cursor:e.object._place?"pointer":""}),onClick:e.menuSel},F({default:o(()=>[d(h(e.object._place)+" ",1)]),_:2},[e.object._place?void 0:{name:"action",fn:o(()=>[c(f,null,{default:o(()=>[c(b,null,{default:o(()=>[d("创建：")]),_:1}),e.models.length?(n(!0),r(j,{key:0},$(e.models,g=>(n(),_(l,{onClick:w=>e.create(g)},{default:o(()=>[d(h(g._title),1)]),_:2},1032,["onClick"]))),256)):(n(),_(b,{key:1},{default:o(()=>[d(" 无可创建的模型 ")]),_:1}))]),_:1})]),key:"0"}]),1032,["title","style","onClick"])}const te=M(x,[["render",ee],["__scopeId","data-v-6ca08769"]]),ne=O({name:"dashboardEditor",components:{DashboardEditorObject:te,InputString:A,KeyPanel:I},props:["object"],provide:{open:{}},data(){return{owner:{},moduleSchema:[],saving:!1}},methods:{async init(){this.moduleSchema=this.object._module.Object.schema,this.owner=await this.object._owner},async save(){await this.object._save()}},mounted(){this.init()}});const se={class:"dashboardEditor"},ie={class:"headerBox"},oe={class:"titleBox"},ae={style:{"font-size":"small",opacity:"0.6",cursor:"pointer"},title:"复制地址"},re={class:"infoBox"};function le(e,t,p,y,s,v){const b=i("n-button"),l=i("n-button-group"),f=i("n-tag"),k=i("n-space"),g=i("input-string"),w=i("dashboard-editor-object"),S=i("key-input"),E=H("clipboard");return n(),r("div",se,[a("div",ie,[a("div",oe,[a("h3",null,h(e.object._title),1),c(l,null,{default:o(()=>[c(b,{loading:e.saving,type:e.object._changed?"default":"tertiary",onClick:t[0]||(t[0]=u=>e.save())},{default:o(()=>[d(" 保存 ")]),_:1},8,["loading","type"])]),_:1})]),T((n(),r("p",ae,[d(h(e.object._place),1)])),[[E,e.object._place.valueOf()]]),a("div",re,[c(k,null,{default:o(()=>[c(f,{size:"small"},{default:o(()=>[d("所有者:"+h(e.owner._title),1)]),_:1}),c(f,{size:"small"},{default:o(()=>[d("更新@"+h(e.$moment(e.object._updatedAt).calendar()),1)]),_:1})]),_:1})])]),c(g,{modelValue:e.object._title,"onUpdate:modelValue":t[1]||(t[1]=u=>e.object._title=u),_key:e.moduleSchema.title||{title:"标题"}},null,8,["modelValue","_key"]),(n(!0),r(j,null,$(e.object._schemaMix,u=>(n(),r(j,null,[u.name&&u.type!=="Array"&&e.$yin.structureType.includes(u.type)?(n(),_(w,{key:0,parent:e.object,_key:u},null,8,["parent","_key"])):u.name?(n(),_(S,{modelValue:e.object[u.name],"onUpdate:modelValue":V=>e.object[u.name]=V,_key:u,key:u.name,object:e.object},null,8,["modelValue","onUpdate:modelValue","_key","object"])):m("",!0)],64))),256))])}const ce=M(ne,[["render",le],["__scopeId","data-v-786c43f8"]]);const ue={name:"Dashboard",components:{MenuFilled:Y,DashboardEditor:ce,DashboardMenuItem:Z,YinMenuItem:U},props:["object","target"],provide(){return{objectList:B(()=>this.objectList),keyList:B(()=>this.keyList),screen:B(()=>this.screen)}},data(){return{screen:{target:[]},objectList:{},keyList:{},dashboardObject:{},objectEditing:{},parent:null,deleting:!1,showMenu:!1,menuHide:!0}},methods:{async init(e){this.parent=this.$route.query.parent,this.target?this.dashboardObject=await C.get(this.target[0]):this.dashboardObject=this.object,document.title=this.dashboardObject._title||this.dashboardObject._place,this.objectEditing=this.dashboardObject,this.screen.target=this.target;for(let t of this.dashboardObject._schemaMix)if(t.type!=="Array"&&C.structureType.includes(t.type)){this.showMenu=!0;return}},menuSel(e=[]){this.screen.target=e.reverse()},async targetChange(e){this.objectEditing={},await N(),this.objectEditing=await C.get(e[e.length-1]),this.$router.push({name:"dashboard",params:{target:e},query:{parent:this.parent}})},async deleteSelf(){this.deleting=!0,await this.dashboardObject._delete(),this.$wx?history.back():window.close()}},watch:{target(e,t){t&&e[0]!==t[0]&&this.init()},"screen.target":{handler:"targetChange",deep:!0}},mounted(){this.$yin.me._id?this.init():this.$router.push("/auth")}},de={class:"mainBox"},he={class:"metaBox"},_e={class:"mainBody"};function pe(e,t,p,y,s,v){const b=i("menu-filled"),l=i("n-icon"),f=i("n-button"),k=i("n-popconfirm"),g=i("n-button-group"),w=i("dashboard-menu-item"),S=i("dashboard-editor");return n(),r("div",{class:"dashboard",onClick:t[2]||(t[2]=E=>s.menuHide=!0)},[a("header",null,[a("div",de,[s.showMenu?(n(),_(f,{key:0,class:"menu",onClick:t[0]||(t[0]=D(E=>s.menuHide=!s.menuHide,["stop"]))},{default:o(()=>[c(l,null,{default:o(()=>[c(b)]),_:1})]),_:1})):m("",!0),a("h3",null,h(s.dashboardObject._title),1)]),a("div",he,[c(g,null,{default:o(()=>[s.parent?(n(),_(k,{key:0,onPositiveClick:v.deleteSelf},{trigger:o(()=>[c(f,{loading:s.deleting},{default:o(()=>[d("删除")]),_:1},8,["loading"])]),default:o(()=>[d(" 是否删除"+h(s.dashboardObject._title||s.dashboardObject._place)+"？ ",1)]),_:1},8,["onPositiveClick"])):m("",!0),c(f,null,{default:o(()=>[d(h(e.$yin.me._title),1)]),_:1})]),_:1})])]),a("div",_e,[s.showMenu?(n(),r("div",{key:0,class:L(["sideBar",{menuHide:s.menuHide}]),onClick:t[1]||(t[1]=D(()=>{},["stop"]))},[s.dashboardObject._id?(n(),_(w,{key:0,onMenuSel:v.menuSel,root:s.dashboardObject},null,8,["onMenuSel","root"])):m("",!0)],2)):m("",!0),s.objectEditing._id?(n(),_(S,{key:1,class:L(["mainBox",{showMenu:s.showMenu}]),object:s.objectEditing},null,8,["class","object"])):m("",!0)])])}const fe=M(ue,[["render",pe],["__scopeId","data-v-17f2d030"]]);export{fe as default};
//# sourceMappingURL=Dashboard-aae5ee6d.js.map
