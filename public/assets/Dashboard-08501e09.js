import{d as w,o as n,c as r,g as a,_ as M,r as s,f as u,t as h,b,n as V,F as j,i as O,a as p,j as D,w as i,e as c,k as z,I as H,K as I,l as A,m as T,q as E,u as U,y as B,s as N,v as L}from"./index-f616c1b3.js";import{Y as q}from"./yinMenuItem-3bd0f4bf.js";const P={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 24 24"},K=a("path",{d:"M18 15v3H6v-3H4v3c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2v-3h-2zM7 9l1.41 1.41L11 7.83V16h2V7.83l2.59 2.58L17 9l-5-5l-5 5z",fill:"currentColor"},null,-1),Y=[K],G=w({name:"FileUploadOutlined",render:function(t,_){return n(),r("svg",P,Y)}}),J={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 24 24"},Q=a("path",{d:"M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z",fill:"currentColor"},null,-1),R=[Q],W=w({name:"MenuFilled",render:function(t,_){return n(),r("svg",J,R)}}),X=w({name:"dashboardMenuItem",inject:["screen","objectList","keyList"],props:["_key","parent","root"],emits:["menuSel"],data(){return{object:{}}},computed:{title(){return this.root?"主页":this.object._id?this._key.title===this.object._title?this.object._title:this._key.title+": "+this.object._title:this._key.title+": "+(this.object._title||"加载中")},main(){var e;return this.root||!this.object._id?!0:this.objectList[this.place]===((e=this.parent)==null?void 0:e._place.valueOf())},place(){var e,t;return((e=this.object._place)==null?void 0:e.valueOf())||((t=this.object.api)==null?void 0:t.place.valueOf())},open(){var t;if(this.root)return!1;const e=this.screen.target.indexOf(this.place);if(e!==-1)return this.screen.target[e-1]===((t=this.parent)==null?void 0:t._place.valueOf())},target(){if(this.main)return this.screen.target[this.screen.target.length-1]===this.place}},methods:{async init(){var e,t,_,y;if(this.root)this.object=this.root,(e=this.objectList)[t=this.place]??(e[t]="dashboard");else try{this.object=await this.parent[this._key.name],(_=this.objectList)[y=this.place]??(_[y]=this.parent._place.valueOf())}catch{this.object._title="未创建"}},menuSel(e){this.place&&(e?(e.push(this.place),this.$emit("menuSel",e)):this.main?this.$emit("menuSel",[this.place]):this.screen.target=[this.place])}},watch:{main(){var e,t,_;(t=this.objectList)[_=this.place]??(t[_]=(e=this.parent)==null?void 0:e._place.valueOf())}},mounted(){this.init(),this.parent&&this.parent._on("update",this.init)},beforeUnmount(){this.main&&delete this.objectList[this.place],this.parent&&this.parent._removeEvent("update",this.init)}});const Z={class:"itemMain"},x={class:"main"},ee={key:0},te={key:1,style:{"margin-left":"13px"}};function ne(e,t,_,y,o,v){const m=s("dashboard-menu-item",!0);return n(),r(j,null,[a("div",{class:V(["dashboardMenuItem",{open:e.open,target:e.target}]),onClick:t[0]||(t[0]=l=>e.menuSel())},[a("div",Z,[a("div",x,[a("p",null,[u(h(e.title),1),e.main?b("",!0):(n(),r("span",ee,"*"))])]),a("p",null,h(e.object.meta),1)]),a("p",null,h(e.object.info),1)],2),e.root?(n(!0),r(j,{key:0},O(e.root._schemaMix,l=>(n(),r(j,null,[l.type!=="Array"&&e.$yin.structureType.includes(l.type)?(n(),p(m,{key:0,onMenuSel:e.menuSel,_key:l,parent:e.root},null,8,["onMenuSel","_key","parent"])):b("",!0)],64))),256)):e.open?(n(),r("div",te,[(n(!0),r(j,null,O(e.object._schemaMix,l=>(n(),r(j,null,[l.type!=="Array"&&e.$yin.structureType.includes(l.type)?(n(),p(m,{key:0,onMenuSel:e.menuSel,_key:l,parent:e.object},null,8,["onMenuSel","_key","parent"])):b("",!0)],64))),256))])):b("",!0)],64)}const se=M(X,[["render",ne],["__scopeId","data-v-4263ded7"]]),oe=w({name:"dashboardEditorObject",inject:["screen","objectList","keyList"],props:["_key","parent"],data(){return{object:{},models:[]}},computed:{title(){return this._key&&this.parent?this.object._id?this._key.title===this.object._title?this.object._title:this._key.title+": "+this.object._title:this._key.title+": "+(this.object._title||"加载中"):""}},methods:{async init(){if(this.parent)try{this.object=await this.parent[this._key.name]}catch{this.object._title="未创建",this.models=await this.parent[this._key.name].models()}},menuSel(){this.object._id&&this.screen.target.push(this.object._place.valueOf())},async create(e){this.object=await this.parent[this._key.name].create({_model:e._id})}},mounted(){this.init()}});function ie(e,t,_,y,o,v){const m=s("n-input-group-label"),l=s("n-button"),f=s("n-input-group"),k=s("n-card");return n(),p(k,{title:e.title,size:"small",class:"dashboardEditorObject",style:z({cursor:e.object._place?"pointer":""}),onClick:e.menuSel},D({default:i(()=>[u(h(e.object._place)+" ",1)]),_:2},[e.object._place?void 0:{name:"action",fn:i(()=>[c(f,null,{default:i(()=>[c(m,null,{default:i(()=>[u("创建：")]),_:1}),e.models.length?(n(!0),r(j,{key:0},O(e.models,g=>(n(),p(l,{onClick:$=>e.create(g)},{default:i(()=>[u(h(g._title),1)]),_:2},1032,["onClick"]))),256)):(n(),p(m,{key:1},{default:i(()=>[u(" 无可创建的模型 ")]),_:1}))]),_:1})]),key:"0"}]),1032,["title","style","onClick"])}const ae=M(oe,[["render",ie],["__scopeId","data-v-6ca08769"]]),re=w({name:"dashboardEditor",components:{FileUploadOutlined:G,DashboardEditorObject:ae,InputString:H,KeyPanel:I},props:["object"],provide:{open:{}},data(){return{owner:{},moduleSchema:[],saving:!1}},methods:{async init(){this.moduleSchema=this.object._module.Object.schema,this.owner=await this.object._owner},async save(){await this.object._save()}},mounted(){this.init()}});const le={class:"dashboardEditor"},ce={class:"headerBox"},de={class:"titleBox"},ue={style:{"font-size":"small",opacity:"0.6",cursor:"pointer"},title:"复制地址"},he={class:"infoBox"};function _e(e,t,_,y,o,v){const m=s("n-button"),l=s("n-button-group"),f=s("n-tag"),k=s("n-space"),g=s("input-string"),$=s("dashboard-editor-object"),S=s("key-input"),C=A("clipboard");return n(),r("div",le,[a("div",ce,[a("div",de,[a("h3",null,h(e.object._title),1),c(l,null,{default:i(()=>[c(m,{loading:e.saving,type:e.object._changed?"default":"tertiary",onClick:t[0]||(t[0]=d=>e.save())},{default:i(()=>[u(" 保存 ")]),_:1},8,["loading","type"])]),_:1})]),T((n(),r("p",ue,[u(h(e.object._place),1)])),[[C,e.object._place.valueOf()]]),a("div",he,[c(k,null,{default:i(()=>[c(f,{size:"small"},{default:i(()=>[u("所有者:"+h(e.owner._title),1)]),_:1}),c(f,{size:"small"},{default:i(()=>[u("更新@"+h(e.$moment(e.object._updatedAt).calendar()),1)]),_:1})]),_:1})])]),c(g,{modelValue:e.object._title,"onUpdate:modelValue":t[1]||(t[1]=d=>e.object._title=d),_key:e.moduleSchema.title||{title:"标题"}},null,8,["modelValue","_key"]),(n(!0),r(j,null,O(e.object._schemaMix,d=>(n(),r(j,null,[d.name&&d.type!=="Array"&&e.$yin.structureType.includes(d.type)?(n(),p($,{key:0,parent:e.object,_key:d},null,8,["parent","_key"])):d.name?(n(),p(S,{modelValue:e.object[d.name],"onUpdate:modelValue":F=>e.object[d.name]=F,_key:d,key:d.name,object:e.object},null,8,["modelValue","onUpdate:modelValue","_key","object"])):b("",!0)],64))),256))])}const pe=M(re,[["render",_e],["__scopeId","data-v-8ffd5cb6"]]);const me={name:"Dashboard",components:{MenuFilled:W,DashboardEditor:pe,DashboardMenuItem:se,YinMenuItem:q},props:["object","target"],provide(){return{objectList:E(()=>this.objectList),keyList:E(()=>this.keyList),screen:E(()=>this.screen)}},data(){return{screen:{target:[]},objectList:{},keyList:{},message:U(),dashboardObject:{},objectEditing:{},parent:null,deleting:!1,showMenu:!1,menuHide:!0}},methods:{async init(e){this.parent=this.$route.query.parent,this.target?this.dashboardObject=await B.get(this.target[0]):this.dashboardObject=this.object,document.title=this.dashboardObject._title||this.dashboardObject._place,this.objectEditing=this.dashboardObject,this.screen.target=this.target;for(let t of this.dashboardObject._schemaMix)if(t.type!=="Array"&&B.structureType.includes(t.type)){this.showMenu=!0;return}},menuSel(e=[]){this.screen.target=e.reverse()},async targetChange(e){this.objectEditing={},await N(),this.objectEditing=await B.get(e[e.length-1]),this.$router.push({name:"dashboard",params:{target:e},query:{parent:this.parent}})},async deleteSelf(){this.deleting=!0,await this.dashboardObject._delete(),this.$wx?history.back():window.close()}},watch:{target(e,t){t&&e[0]!==t[0]&&this.init()},"screen.target":{handler:"targetChange",deep:!0}},mounted(){this.$yin.me._id?this.init():this.$router.push("/auth")}},be={class:"mainBox"},fe={class:"metaBox"},je={class:"mainBody"};function ye(e,t,_,y,o,v){const m=s("menu-filled"),l=s("n-icon"),f=s("n-button"),k=s("n-popconfirm"),g=s("n-button-group"),$=s("dashboard-menu-item"),S=s("dashboard-editor");return n(),r("div",{class:"dashboard",onClick:t[2]||(t[2]=C=>o.menuHide=!0)},[a("header",null,[a("div",be,[c(f,{class:"menu",onClick:t[0]||(t[0]=L(C=>o.menuHide=!o.menuHide,["stop"]))},{default:i(()=>[c(l,null,{default:i(()=>[c(m)]),_:1})]),_:1}),a("h3",null,h(o.dashboardObject._title),1)]),a("div",fe,[c(g,null,{default:i(()=>[o.parent?(n(),p(k,{key:0,onPositiveClick:v.deleteSelf},{trigger:i(()=>[c(f,{loading:o.deleting},{default:i(()=>[u("删除")]),_:1},8,["loading"])]),default:i(()=>[u(" 是否删除"+h(o.dashboardObject._title||o.dashboardObject._place)+"？ ",1)]),_:1},8,["onPositiveClick"])):b("",!0),c(f,null,{default:i(()=>[u(h(e.$yin.me._title),1)]),_:1})]),_:1})])]),a("div",je,[o.showMenu?(n(),r("div",{key:0,class:V(["sideBar",{menuHide:o.menuHide}]),onClick:t[1]||(t[1]=L(()=>{},["stop"]))},[o.dashboardObject._id?(n(),p($,{key:0,onMenuSel:v.menuSel,root:o.dashboardObject},null,8,["onMenuSel","root"])):b("",!0)],2)):b("",!0),o.objectEditing._id?(n(),p(S,{key:1,class:"mainBox",object:o.objectEditing},null,8,["object"])):b("",!0)])])}const ke=M(me,[["render",ye],["__scopeId","data-v-2d10f543"]]);export{ke as default};
