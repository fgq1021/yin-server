import{_ as E,u as x,P as M,r as _,o as r,c as m,g as i,t as g,b as c,f as b,F as v,i as w,w as u,a as O,e as y}from"./index-62d97ac6.js";const B={name:"Dashboard",props:["object","place"],data(){return{message:x(),saving:!1,deleting:!1,dashboardObject:{},objectEditing:{},childrenMenuName:null,children:[],menuOptions:[],structureType:this.$yin.structureType}},computed:{childrenMenu(){return this.children.map(e=>({label:e._title,key:e._place}))}},methods:{async init(){this.place?this.dashboardObject=await this.$yin.get(this.place):this.dashboardObject=this.object,await this.makeMenu(),this.objectEditing=this.dashboardObject},async makeMenu(){this.menuOptions=await this.makeMenuChildren(this.dashboardObject,1),this.menuOptions[0]&&(this.menuOptions[0].label="主页")},async makeMenuChildren(e,a){const s=[];let l=0;for(let t in e._schemaMix){const n=e._schemaMix[t];if(this.structureType.indexOf(n.type)!==-1&&n.type!=="Array"){l++;try{const o=await e[n.name],p={label:o._title,key:o._place};if(a){const h=await this.makeMenuChildren(o,a-1);h.length&&(p.children=h)}s.push(p)}catch{}}}return l===e._schemaMix.length?s:l?[{label:e._title+"配置",key:e._place}].concat(s):s},async menuSel(e){this.childrenMenuName=null,this.objectEditing={},this.objectEditing=await this.$yin.get(e)},async childSel(e){this.objectEditing={},this.objectEditing=await this.$yin.get(e)},showKey(e){return this.structureType.indexOf(e.type)===-1?!0:e.type==="Array"},async openEl(e){const a=new M(e.place),s=await this.$yin.get(e.place),l=s._schemaMix[a.key];this.children=await s[l.name],await this.childSel(e.object),this.childrenMenuName=s._title+"."+l.title},async save(){this.saving=!0;try{await this.objectEditing._save(),this.message.success((this.objectEditing._title||" #"+this.objectEditing._id)+" 保存成功")}catch(e){this.message.error(e.message)}this.saving=!1},async deleteSelf(){this.deleting=!0,await this.objectEditing._delete(),this.close()}},mounted(){this.init()}},S={class:"dashboard"},C={class:"mainBox"},N={class:"titleBox"},V={class:"metaBox"},T={class:"userBox"},U={class:"mainBody"},D={class:"sideBar"},P={key:0,class:"childrenBar"},A={class:"childrenTitle"},F={key:1,class:"mainBox"},I={class:"editor"},K={class:"fnBox"};function L(e,a,s,l,t,n){const o=_("n-menu"),p=_("key-input"),h=_("n-button"),f=_("n-button-group"),j=_("n-popconfirm");return r(),m("div",S,[i("header",null,[i("div",C,[i("div",N,[i("h3",null,g(t.dashboardObject._title),1)])]),i("div",V,[i("div",T,[i("p",null,g(e.$yin.me._title||"我"),1)])])]),i("div",U,[i("div",D,[c(o,{options:t.menuOptions,"onUpdate:value":n.menuSel},null,8,["options","onUpdate:value"])]),t.childrenMenuName?(r(),m("div",P,[i("p",A,g(t.childrenMenuName),1),c(o,{options:n.childrenMenu,"onUpdate:value":n.childSel,"default-value":t.objectEditing._place},null,8,["options","onUpdate:value","default-value"])])):b("",!0),t.objectEditing._id?(r(),m("div",F,[i("div",I,[(r(!0),m(v,null,w(t.objectEditing._schemaMix,d=>(r(),m(v,null,[n.showKey(d)?(r(),O(p,{modelValue:t.objectEditing[d.name],"onUpdate:modelValue":k=>t.objectEditing[d.name]=k,_key:d,key:d.name,object:t.objectEditing,onObjectSel:n.openEl},null,8,["modelValue","onUpdate:modelValue","_key","object","onObjectSel"])):b("",!0)],64))),256)),i("div",K,[c(f,null,{default:u(()=>[c(h,{loading:t.saving,onClick:a[0]||(a[0]=d=>n.save())},{default:u(()=>[y("保存")]),_:1},8,["loading"])]),_:1}),c(f,null,{default:u(()=>[c(j,{onPositiveClick:n.deleteSelf},{trigger:u(()=>[c(h,{tertiary:"",loading:t.deleting},{default:u(()=>[y("删除")]),_:1},8,["loading"])]),default:u(()=>[y(" 确定删除？ ")]),_:1},8,["onPositiveClick"])]),_:1})])])])):b("",!0)])])}const z=E(B,[["render",L],["__scopeId","data-v-08327035"]]);export{z as default};
